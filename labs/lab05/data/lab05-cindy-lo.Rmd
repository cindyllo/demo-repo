---
title: 'Lab 05: First contact with dplyr and ggplot2'
author: "Cindy Lo"
date: "9/26/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.path = '../images/')
```

## Filestructure and Shell commands
```{r, eval = FALSE}
cd labs
mkdir lab05
cd lab05
mkdir data report images
ls
vim README.md
cat README.md
cd data
curl -O https://raw.githubusercontent.com/ucb-stat133/stat133-fall-2018/master/data/nba2018-players.csv
ls
wc nba2018-players.csv
head nba2018-players.csv
tail nba2018-players.csv
```

## Installing packages
```{r}
library(dplyr)
library(ggplot2)
library(readr)
```

## NBA Players Data
```{r}
dat <- read.csv('nba2018-players.csv', stringsAsFactors = FALSE)
dat <- read_csv('nba2018-players.csv')
```

## Filtering, slicing, and selecting
`slice()` allows you to select rows by position:
```{r}
three_rows <- slice(dat, 1:3)
three_rows
```
`filter()` allows you to select rows by condition:
```{r}
gt_85 <- filter(dat, height > 85)
gt_85
```
`select()` allows you to select columns by name:
```{r}
player_height <- select(dat, player, height)
player_height
```

Use `slice()` to subset the data by selecting the first 5 rows
```{r}
five_rows <- slice(dat, 1:5)
five_rows
```

Use `slice()` to subset the data by selecting rows 10, 15, 20, ..., 50
```{r}
by_five <- slice(dat, 5*(2:10))
by_five
```

Use `slice()` to subset the data by selecting the last 5 rows
```{r}
last_five <- slice(dat, 472:477)
last_five
```

Use `filter()` to subset those players with height less than 70 inches tall
```{r}
small_70 <- filter(dat, height < 70)
small_70
```

Use `filter()` to subset rows of GSW
```{r}
nba_gsw <- filter(dat, team == "GSW")
nba_gsw
```

Use `filter()` to subset rows of GSW centers
```{r}
nba_gsw_C <- filter(nba_gsw, position == "C")
nba_gsw_C
```

Use `filter()` and then `select()` to subset rows of Lakers and then display their names
```{r}
nba_lal <- filter(dat, team == "LAL")
nba_lal_players <- select(nba_lal, player)
nba_lal_players
```

Use `filter()` and then `select()` to display the name and salary of GSW point guards
```{r}
nba_gsw_PG <- filter(nba_gsw, position == "PG")
player_salary <- select(nba_gsw_PG, player, salary)
player_salary
```

Find how to select the name, age, and team of players with more than 10 years of experience, making 10 million dollars or less
```{r}
nba_10yr10mill <- filter(dat, experience > 10 & salary <= 10000000)
nba_10yr10millshow <- select(nba_10yr10mill, player, age, team)
nba_10yr10millshow
```

Find how to select the name, team, height, and weight of rookie players, 20 years old, displaying only the first five occurrences
```{r}
rookie_20 <- filter(dat, experience <= 10 & age == 20)
rookienthw <- select(rookie_20, player, team, height, weight)
head(rookienthw, 5)
```

## Adding new variables: `mutate()`
```{r}
gsw <- filter(dat, team == "GSW")
gsw <- select(gsw, player, height, weight)
gsw <- slice(gsw, c(4, 8, 10, 14, 15))
gsw
mutate(gsw, ht_wt = height/weight)
gsw2 <- mutate(gsw, ht_m = height * 0.0254, wt_kg = weight * 0.4536)
gsw2
```

## Reordering rows: `arrange()`
```{r}
arrange(gsw, height)
arrange(gsw, desc(height))
arrange(gsw, height, weight)
```

Using the data frame `gsw` add a new variable `product` with the product of height and weight
```{r}
gsw <- mutate(gsw, product = height*weight)
gsw
```

Create a new dataa frame gsw3, by adding columns `log_height` and `log_weight` with the log transformations of `height` and `weight`
```{r}
gsw3 <- mutate(gsw, log_height = log(height), log_weight = log(weight))
gsw3
```

Use the original data frame to `filter()` and `arrange()` those players with height less than 71 inchess tall, in increasing order
```{r}
small_71 <- filter(dat, height < 71)
arrange(small_71, height)
```

Display the name, team, and salary of the top-5 highest paid players
```{r}
top_paid <- arrange(dat, desc(salary))
top_paid <- select(top_paid, player, team, salary)
head(top_paid, 5)
```

Dislpay the name, team, and points3, of the top 10 three-point players
```{r}
top_points3 <- arrange(dat, desc(points3))
top_points3 <- select(top_points3, player, team, points3)
head(top_points3, 10)
```

Create a data frame `gsw_mpg` of GSW players that contains variables for player name, experience and `min_per_game` sorted by `min_per_game` in descending order
```{r}
gsw_mpg <- filter(dat, team == "GSW")
gsw_mpg <- mutate(gsw_mpg, min_per_game = minutes / games)
gsw_mpg <- select(gsw_mpg, player, experience, min_per_game)
gsw_mpg <- select(gsw_mpg, player, experience, min_per_game)
gsw_mpg <- arrange(gsw_mpg, desc(min_per_game))
gsw_mpg
```

## Summarzing values with `summarise()`
```{r}
summarise(dat, avg_salary = mean(salary))
summarise(dat,
          min = min(salary),
          median = median(salary),
          avg = mean(salary),
          max = max(salary))
```

## Grouped operations
```{r}
#average salary, grouped by team
summarise(
  group_by(dat, team),
  avg_salary = mean(salary)
)
#average salary, grouped by position
summarise(
  group_by(dat, position),
  avg_salary = mean(salary)
)
#average weight and height, grouped by position, in descending order of average height
arrange(
  summarise(
    group_by(dat, position),
    avg_height = mean(height),
    avg_weight = mean(weight)),
  desc(avg_height)
)
```

Use `summarise()` to get the largest height value
```{r}
summarise(dat, max_height = max(height))
```

Use `summarise()` to get the standard deviation of `points3`
```{r}
summarise(dat, sd_points3 = sd(points3))
```

Use `summarise()` and `group_by()` to display the median of three-points, by team
```{r}
summarise(group_by(dat, team), median_points3 = median(points3))
```

Display the average triple points by team, in ascending order, of the bottom-5 teams
```{r}
head(
  arrange(
    summarise(
      group_by(dat, team),
      avg_points3 = mean(points3)),
    avg_points3),
  5)
```

Obtain the mean and standard deviation of `age` for Power Forwards, with 5 and 10 years(including) years of experience
```{r}
pf_5_10 <- filter(dat, position == "PF" & (experience == 5 | experience == 10))
summarise(pf_5_10, mean_of_pf510 = mean(age), standard_deviation_pf510 = sd(age))
```

## First contact with `ggplot()`
```{r}
# scatterplot (option 1)
ggplot(data = dat) + geom_point(aes(x = points, y = salary))

# scatterplot (option 2)
ggplot(data = dat, aes(x = points, y = salary)) + geom_point()

# colored scatterplot
ggplot(data = dat, aes(x = points, y = salary)) + geom_point(aes(color = position))

#sized and colored scatterplot
ggplot(data = dat, aes(x = points, y = salary)) + geom_point(aes(color = position, size = points3))

#sized and colored scatterplot but transparent
ggplot(data = dat, aes(x = points, y = salary)) +
  geom_point(aes(color = position, size = points3), alpha = 0.7)
```

Use the data frame `gsw` to make a scatterplot of height and weight
```{r}
ggplot(data = gsw, aes(x = height, y = weight)) + geom_point(aes(color = player), alpha = 0.4)
```

Find out how to make another scatterplot of height and weight, using `geom_text()` to display the names of the players
```{r}
ggplot(data = gsw, aes(x = height, y = weight)) + geom_point(aes(color = player), alpha = 0.4) + geom_text(aes(label = player), nudge_x = 1, nudge_y = 1)
```

Get a scatterplot of `height` and `weight`, for ALL the warriors, displaying their names with `geom_label()`
```{r}
gsw_all <- filter(dat, team == "GSW")
ggplot(data = gsw_all, aes(x = height, y = weight)) + geom_point(aes(color = player), alpha = 0.3) + geom_label(aes(label = player), nudge_x = 1, nudge_y = 1, alpha = 0.1)
```

Get a density plot of `salary` for all NBA players
```{r}
ggplot(dat, aes(salary)) + geom_density(kernel = "gaussian", fill = "pink")
```

Get a histogram of `points2` with binwidth of 50 for all NBA players
```{r}
ggplot(dat, aes(points2)) + geom_histogram(binwidth = 50, fill = "lavender")
```

Get a barchart of the `position` frequencies for all NBA players
```{r}
ggplot(dat, aes(position)) + geom_bar(fill = "light blue")
```

Make a scatterplot of `experience` and `salary` of all Centers and use `geom_smooth()` to add a regression line
```{r}
centers <- filter(dat, position == "C")
ggplot(data = centers, aes(x = experience, y = salary)) + geom_point() + geom_smooth(method = lm)
```

Repeat the same scatterplot of `experience` and `salary` of all Centers, but now use geom_smooth() to add a loess line (i.e. smooth line)
```{r}
ggplot(data = centers, aes(x = experience, y = salary)) + geom_point() + geom_smooth(method = loess)
```

## Faceting
```{r}
#scatterplot by position
ggplot(data = dat, aes(x = points, y = salary)) + geom_point() + facet_wrap(~ position)
```

```{r}
# scatterplot by position
ggplot(data = dat, aes(x = points, y = salary)) +
  geom_point(aes(color = position), alpha = 0.7) +
  facet_grid(~ position) +
  geom_smooth(method = loess)
```

```{r}
# scatterplot by position
ggplot(data = dat, aes(x = points, y = salary)) +
  geom_point(aes(color = position), alpha = 0.7) +
  facet_grid(position ~ .) +
  geom_smooth(method = loess)
```

Make scatterplots of experience and salary faceting by position
```{r}
ggplot(data = dat, aes(x = experience, y = salary)) +
  geom_point(aes(color = position), alpha = 0.7) +
  facet_grid(position ~ .) +
  geom_smooth(method = loess)
```

Make scatterplots of experience and salary faceting by team
```{r}
ggplot(data = dat, aes(x = experience, y = salary)) + geom_point() + facet_wrap(team ~ .)
```

Make density plots of age faceting by team
```{r}
ggplot(dat, aes(salary)) + geom_density(kernel = "gaussian", fill = "snow") + facet_wrap(team ~ .)
```

Make scatterplots of height and weight faceting by position
```{r}
ggplot(data = dat, aes(x = height, y = weight)) + geom_point() + geom_point(aes(color = position), alpha = 0.7) + facet_wrap(position ~ .)

ggplot(data = dat, aes(x = height, y = weight)) + geom_point() + geom_point(aes(color = position), alpha = 0.7) + facet_grid(position ~ .)
```

Make scatterplots of height and weight, with a 2-dimensional density, geom_density2d(), faceting by position
```{r}
ggplot(data = dat, aes(x = height, y = weight)) + geom_point() + geom_point(aes(color = position), alpha = 0.7) + facet_wrap(position ~ .) + geom_density2d()

ggplot(data = dat, aes(x = height, y = weight)) + geom_point() + geom_point(aes(color = position), alpha = 0.7) + facet_grid(position ~ .) + geom_density2d()
```

Make a scatterplot of experience and salary for the Warriors, but this time add a layer with theme_bw() to get a simpler background
```{r}
warriors <- filter(dat, team == "GSW")
ggplot(data = warriors, aes(x = experience, y = salary)) + geom_point() + geom_point(aes(color = position), alpha = 0.7) + facet_grid(position ~ .) + theme_bw()
```

Repeat any of the previous plots but now adding a leyer with another theme e.g. theme_minimal(), theme_dark(), theme_classic()
```{r}
ggplot(data = warriors, aes(x = experience, y = salary)) + geom_point() + geom_point(aes(color = position), alpha = 0.7) + facet_grid(position ~ .) + theme_minimal()

ggplot(data = warriors, aes(x = experience, y = salary)) + geom_point() + geom_point(aes(color = position), alpha = 0.7) + facet_grid(position ~ .) + theme_dark()

ggplot(data = warriors, aes(x = experience, y = salary)) + geom_point() + geom_point(aes(color = position), alpha = 0.7) + facet_grid(position ~ .) + theme_classic()
```

## More shell commands
```{r, eval = FALSE}
cd Desktop/stat133/demo-repo/labs/lab05/images
ls
ls -l
ls -lt
ls -r
mkdr ../copies
cp unnamed-chunk-32-1.png ../copies
cp *.png ../copies
cd ../copies
mv unnamed-chunk-32-1.png renamed-chunk-32-1.png
mv unnamed-chunk-32-2.png renamed-chunk-32-2.png
cd ../report
mv ../copies ../copy-files
rm ../copy-files/unnamed-chunk-32-3.png
rm ../copy-files/*.*
rmdir ../copy-files
```